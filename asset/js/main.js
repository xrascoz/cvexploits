let noticePop = document.querySelector(".notice-pop")




// Toggle Github Pop Div
let iconGitHub = document.querySelectorAll(".icon-git-hub");
let githubPopDiv = document.querySelector(".github-pop-div");
let githubPopDivCard = document.querySelector(".github-pop-div .card-div")
let xDivGithub = document.querySelector(".x-div-github");
let aLinkGithub = document.querySelector(".a-link-github");
let nameCardCVE = document.querySelector(".name-card-CVE");
let aCVEPop = document.querySelector(".a-CVE-pop")

let toggleClassGitHub = () => {
    githubPopDiv.classList.toggle("active");
};


let getApi = async (e , a) => {
  nameCardCVE.innerHTML = e;
  const response = await fetch(`/popup/${e}`);
  const jsonData = await response.json();
  let dataArrayLinks = jsonData.result;
  aLinkGithub.innerHTML = ""; // Clear the existing values
  dataArrayLinks.forEach(element => {
    aLinkGithub.innerHTML += `<a href=${element} target="_blank" rel="noopener noreferrer">${element}</a>`;
  });
  aCVEPop.setAttribute('href', `${a}`)
}

iconGitHub.forEach(element => {
    element.addEventListener("click", () => {
     getApi(element.parentElement.querySelector(".name-of-text-card").innerHTML ,element.parentElement.querySelector("a").getAttribute('href') )
        toggleClassGitHub();
        document.body.classList.add("active");
    });
});

githubPopDiv.addEventListener("mouseup", (e) => {
    let arrayChildNodes = githubPopDivCard.childNodes;
    if (e.target !== githubPopDivCard) {
        toggleClassGitHub();
        document.body.classList.remove("active");
    }
    arrayChildNodes.forEach(element => {
        element.addEventListener("click", () => {
            console.log(element)
            if (element == element) {
                githubPopDiv.classList.add("active");
                document.body.classList.add("active");
            } if (element.classList.contains("x-button")) {
                toggleClassGitHub();
                document.body.classList.remove("active");
            }
        })
    });
});



// Subscribe-button Pop Div

let subscribeButton = document.querySelector(".subscribe-button")
let subscribePop = document.querySelector(".subscribe-pop")
let subscribePopCard = document.querySelector(".subscribe-pop .card-div")
let xSubscribe = document.querySelector(".x-subscribe");

let toggleClassSubscribe = () => {
    subscribePop.classList.toggle("active");
    removeClass()
    githubPopDiv.classList.remove("active");
};


subscribeButton.addEventListener("click", () => {
    toggleClassSubscribe();
    document.body.classList.toggle("active");
    if (githubPopDiv.classList.contains("active")) {
        document.body.classList.add("active")
    }
});

subscribePop.addEventListener("mouseup", (e) => {
    let arrayChildNodes = subscribePopCard.childNodes;
    if (e.target !== subscribePopCard) {
        toggleClassSubscribe();
        document.body.classList.remove("active");
    }
    arrayChildNodes.forEach((element) => {
        element.addEventListener("click", () => {
            if (element == element) {
                subscribePop.classList.add("active");
                document.body.classList.add("active");
            }
            if (element.classList.contains("x-button")) {
                console.log(element);
                toggleClassSubscribe();
                document.body.classList.remove("active");
            }
        });
    });
});

let subscribePopFuncStorage = (e) => {
    if (!localStorage.getItem("subscribe")) {
        toggleClassSubscribe();
        document.body.classList.toggle("active");
        if (githubPopDiv.classList.contains("active")) {
            document.body.classList.add("active")
        }
    }
    localStorage.setItem("subscribe", "subscribe showed");
};

setTimeout((e) => {
    subscribePopFuncStorage(e); 
}, 20000)





// About Pop Div

let infoAbout = document.querySelector(".info-about")
let aboutPopDiv = document.querySelector(".about-pop-div")
let aboutPopDivCard = document.querySelector(".about-pop-div .card-div")
let xDivAbout = document.querySelector(".x-div-about")

let toggleClass = () => {
   aboutPopDiv.classList.toggle("active")

}
let removeClass = () => {
   aboutPopDiv.classList.remove("active")
   noticePop.classList.remove("active")
}

infoAbout.addEventListener("click", () => {

   toggleClass()
   document.body.classList.toggle("active")
   if (githubPopDiv.classList.contains("active")) {
       document.body.classList.add("active")
   } else if (subscribePop.classList.contains("active")) {
       document.body.classList.add("active")
   }
   githubPopDiv.classList.remove("active")
   subscribePop.classList.remove("active")
   noticePop.classList.remove("active")
})

aboutPopDiv.addEventListener("mouseup", (e) => {
   let arrayChildNodes = aboutPopDivCard.childNodes;
   if (e.target !== aboutPopDivCard) {
       toggleClass();
       document.body.classList.remove("active");
   }
   arrayChildNodes.forEach(element => {
       element.addEventListener("click", () => {
           console.log(element)
           if (element == element) {
               aboutPopDiv.classList.add("active");
               document.body.classList.add("active");
           } if (element.classList.contains("x-button")) {
               toggleClass();
               document.body.classList.remove("active");
           }
       })
   });
});



// notice-pop button Pop Div

let warningIcon = document.querySelector(".warning-icon")
// let noticePop = document.querySelector(".notice-pop")
let noticePopCard = document.querySelector(".notice-pop .card-div")
let xNotice = document.querySelector(".x-notice");

let toggleClassNotice = () => {
    noticePop.classList.toggle("active");
    githubPopDiv.classList.remove("active");
};


warningIcon.addEventListener("click", () => {
    toggleClassNotice();
    document.body.classList.toggle("active");
    if (githubPopDiv.classList.contains("active")) {
        document.body.classList.add("active")
    }
});

noticePop.addEventListener("mouseup", (e) => {
    let arrayChildNodes = noticePopCard.childNodes;
    if (e.target !== noticePopCard) {
        toggleClassNotice();
        document.body.classList.remove("active");
    }
    arrayChildNodes.forEach((element) => {
        element.addEventListener("click", () => {
            if (element == element) {
                noticePop.classList.add("active");
                document.body.classList.add("active");
            }
            if (element.classList.contains("x-button")) {
                console.log(element);
                toggleClassNotice();
                document.body.classList.remove("active");
            }
        });
    });
});




let noticePopFuncStorage = (e) => {
    if (!localStorage.getItem("notice")) {
        toggleClassNotice()
        document.body.classList.toggle("active");
        if (githubPopDiv.classList.contains("active")) {
            document.body.classList.add("active")
        }
    }
    localStorage.setItem("notice", "notice showed");
};

setTimeout((e) => {
    noticePopFuncStorage(e); // Pass the event parameter here
}, 2000)





// Show More

let pCardParent = document.querySelectorAll(".p-card-parent");
let activeElement = null;

pCardParent.forEach(element => {
    element.addEventListener("click", () => {
        if (activeElement !== element) {
            removeShowMoreActive();
            element.querySelector(".p-card").classList.add("active");
            element.querySelector(".show-more").innerHTML = "show less";
            activeElement = element;
        } else {
            element.querySelector(".p-card").classList.remove("active");
            element.querySelector(".show-more").innerHTML = "show more";
            activeElement = null;
        }
    });
});

let removeShowMoreActive = () => {
    pCardParent.forEach(element => {
        element.querySelector(".p-card").classList.remove("active");
        element.querySelector(".show-more").innerHTML = "show more";
    });
};

// ----------


// let aCVEPop = document.querySelector(".a-CVE-pop")
//  aCVEPop.innerHTML = `https://cve.mitre.org/cgi-bin/cvename.cgi?name=${}`


// let getApi = async (e) => {
//     nameCardCVE.innerHTML = e;
//     const response = await fetch(`/popup/${e}`);
//     const jsonData = await response.json();
//     let dataArrayLinks = jsonData.result;
//     aLinkGithub.innerHTML = ""; // Clear the existing values
//     dataArrayLinks.forEach(element => {
//         aLinkGithub.innerHTML += `<a href=${element} target="_blank" rel="noopener noreferrer">${element}</a>`;
//     });
// }

// let FormSubscribeSubmit = document.getElementById("form-subscribe-submit")

// FormSubscribeSubmit.addEventListener("click", (e) => {
//     e.preventDefault()
//     const name = FormSubscribe.querySelector(".name").value
//     const email = FormSubscribe.querySelector(".email").value
//     console.log(name)
//     console.log(email)

//     const data = {
//         name: name,
//         email: email
//     };



//     console.log(data)

//     fetch('/sup', {
//         method: 'POST',
//         headers: {
//             'Content-Type': 'application/json'
//         },
//         body: JSON.stringify(data)
//     }).then(response => response.json())
//         .then(result => {
//             console.log(result);
//         })
//         .catch(error => {
//             console.error(error);
//         });
// })


// ----------



// send email data ----------

// let FormSubscribeSubmit = document.getElementById("form-subscribe-submit")
// let FormSubscribe = document.getElementById("form-subscribe")
// let imgForm = document.querySelector(".img-form")
// let subscribePopCardH1Text = document.querySelector(".subscribe-pop .card-div .h1-text");
// let subscribePopCardPText = document.querySelector(".subscribe-pop .card-div p");

// let resetSubscribePopCardH1Text = subscribePopCardH1Text.innerHTML
// let resetsubscribePopCardPText = subscribePopCardPText.innerHTML

// let resetForm = () => {
//     subscribePopCardH1Text.innerHTML = resetSubscribePopCardH1Text
//     subscribePopCardPText.innerHTML = resetsubscribePopCardPText
//     // imgForm.classList.remove("active")
//     FormSubscribe.classList.remove("disabled")
//     subscribePopCard.classList.remove("success")
//     subscribePopCard.classList.remove("error")
// }



// setTimeout(() => {
//     resetForm()
// }, 2000);


// FormSubscribeSubmit.addEventListener("click", (e) => {
//     e.preventDefault()

//     const name = FormSubscribe.querySelector(".name").value
//     const email = FormSubscribe.querySelector(".email").value
//     console.log(name)
//     console.log(email)

//     const data = {
//         name: name,
//         email: email
//     };
//     console.log(data)

//     fetch('/sub', {
//         method: 'POST',
//         headers: {
//             'Content-Type': 'application/json'
//         },
//         body: JSON.stringify(data)
//     }).then(response => response.json())
//         .then(result => {
//             console.log(result);
//             FormSubscribe.classList.add("disabled")
//             imgForm.classList.add("active")
//             subscribePopCard.classList.add("success")
//             subscribePopCardH1Text.classList.add("success")
//             subscribePopCardH1Text.innerHTML = "Success"
//             imgForm.setAttribute("src", "asset/img/icon/success.svg")
//         })
//         .catch(error => {
//             console.error(error);
//             FormSubscribe.classList.add("disabled")
//             imgForm.classList.add("active")
//             subscribePopCard.classList.add("error")
//             subscribePopCardH1Text.classList.add("error")
//             subscribePopCardH1Text.innerHTML = "error"
//             imgForm.setAttribute("src", "asset/img/icon/error.svg")
//         });
// })
